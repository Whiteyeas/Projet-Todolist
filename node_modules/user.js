
var mysql = require('mysql');
var con = mysql.createConnection({
		host: "localhost",
		user: "root",
		password: "",
		database: "todolist"
	});

connection = function(email, password, callback){
	con.query("SELECT * FROM users WHERE Name ='"+email+"' AND Password = '"+password+"'", function (error, results, fields){
		if (error) throw error;
		if (results.length > 0) {
			callback(results);
		}else
			callback(null);
	});
};


verification = function(email, password, callback){
		con.query("SELECT * FROM users WHERE Name ='"+email+"' AND Password = '"+password+"'", function (error, results, fields){
		if (error) throw error;
		if (results.length > 0) {
			callback(true);
		}else
			callback(false);
	});

};

register = function(email, password){
	con.query("INSERT INTO users SET Name ='"+email+"', Password ='"+password+"'", function (error, results, fields){
	if (error) throw error;		
	});
};

removeUser = function(name){
	con.query("DELETE FROM users WHERE Name ='"+name+"'", function (error, results, fields){
		if (error) throw error;		
	});

};

addTask = function(idUser, position, titre, description, date, idGroupe) {
	con.query("INSERT INTO tasks SET idUser ='"+idUser+"', position ='"+position+"', titre ='"+titre+"', description ='"+description+"', date ='"+date+"', idGroupe ='"+idGroupe+"'", function (error, results, fields){
		if (error) throw error;		
	});
};

modifTask = function(id, position, titre, description, date, idGroupe, valide){
	con.query("UPDATE INTO tasks SET position ='"+position+"', titre ='"+titre+"', description ='"+description+"', date ='"+date+"', idGroupe ='"+idGroupe+"', valide ='"+valide+"' WHERE id ='"+id+"'", function (error, results, fields){
		if (error) throw error;		
	});
};

removeTask = function(id){
	con.query("DELETE FROM tasks WHERE id ='"+id+"'", function (error, results, fields){
		if (error) throw error;		
	});
};

showTask = function(idUser, callback){
	con.query("SELECT * FROM taskgroup t INNER JOIN tasks ta ON t.id = ta.idGroupe WHERE ta.idUser ='"+idUser+"' ORDER BY idGroupe, position", function (error, results, fields){
		if (error) throw error;	
		callback(results);	
	});
};

modifTaskGroup = function (id, title, couleur) {
	con.query("UPDATE INTO taskgroup SET title ='"+title+"', couleur ='"+couleur+"' WHERE id = '"+id+"'", function (error, results, fields){
		if (error) throw error;	
	});
};

exports.verification = verification;
exports.register = register;
exports.connection = connection;
exports.removeUser = removeUser;
exports.addTask = addTask;
exports.modifTask = modifTask;
exports.removeTask = removeTask;
exports.showTask = showTask;
exports.modifTaskGroup = modifTaskGroup;
